#include "mbed.h"
#include "RawOled12832_sh1306.h"

RawOled12832_sh1306 lcd(P3_0,P3_1);

static const char *font_16x8=//[95][16]={
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"// 
"\x00\x00\x00\x18\x18\x18\x18\x18\x18\x18\x00\x18\x18\x00\x00\x00"//!
"\x00\x00\x66\x66\x66\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"//"
"\x00\x00\x00\x36\x36\x36\x7F\x36\x36\x7F\x36\x36\x36\x00\x00\x00"//#
"\x00\x00\x08\x08\x3E\x6B\x0B\x0B\x3E\x68\x68\x6B\x3E\x08\x08\x00"//$
"\x00\x00\x00\x66\x6B\x36\x30\x18\x18\x0C\x6C\xD6\x66\x00\x00\x00"//%
"\x00\x00\x00\x1C\x36\x36\x1C\x6E\x3B\x33\x33\x3B\x6E\x00\x00\x00"//&
"\x00\x00\x18\x18\x0C\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"//'
"\x00\x00\x00\x30\x18\x0C\x0C\x0C\x0C\x0C\x0C\x18\x30\x00\x00\x00"//(
"\x00\x00\x00\x0C\x18\x30\x30\x30\x30\x30\x30\x18\x0C\x00\x00\x00"//)
"\x00\x00\x00\x00\x00\x00\x36\x1C\x7F\x1C\x36\x00\x00\x00\x00\x00"//*
"\x00\x00\x00\x00\x00\x00\x18\x18\x7E\x18\x18\x00\x00\x00\x00\x00"//+
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x18\x18\x0C\x00\x00"//,
"\x00\x00\x00\x00\x00\x00\x00\x00\x7F\x00\x00\x00\x00\x00\x00\x00"//-
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x18\x18\x00\x00\x00"//.
"\x00\x00\x00\x60\x60\x30\x30\x18\x18\x0C\x0C\x06\x06\x00\x00\x00"///
"\x00\x00\x00\x3E\x63\x63\x73\x7B\x6F\x67\x63\x63\x3E\x00\x00\x00"//0
"\x00\x00\x00\x18\x1C\x1E\x18\x18\x18\x18\x18\x18\x7E\x00\x00\x00"//1
"\x00\x00\x00\x3E\x63\x63\x60\x30\x18\x0C\x06\x03\x7F\x00\x00\x00"//2
"\x00\x00\x00\x3E\x63\x63\x60\x3C\x60\x60\x63\x63\x3E\x00\x00\x00"//3
"\x00\x00\x00\x60\x70\x78\x6C\x66\x63\x7F\x60\x60\x60\x00\x00\x00"//4
"\x00\x00\x00\x7F\x03\x03\x03\x3F\x60\x60\x60\x63\x3E\x00\x00\x00"//5
"\x00\x00\x00\x3C\x06\x03\x03\x3F\x63\x63\x63\x63\x3E\x00\x00\x00"//6
"\x00\x00\x00\x7F\x60\x60\x30\x30\x18\x18\x0C\x0C\x0C\x00\x00\x00"//7
"\x00\x00\x00\x3E\x63\x63\x63\x3E\x63\x63\x63\x63\x3E\x00\x00\x00"//8
"\x00\x00\x00\x3E\x63\x63\x63\x63\x7E\x60\x60\x30\x1E\x00\x00\x00"//9
"\x00\x00\x00\x00\x00\x00\x18\x18\x00\x00\x00\x18\x18\x00\x00\x00"//:
"\x00\x00\x00\x00\x00\x00\x18\x18\x00\x00\x00\x18\x18\x0C\x00\x00"//;
"\x00\x00\x00\x00\x60\x30\x18\x0C\x06\x0C\x18\x30\x60\x00\x00\x00"//<
"\x00\x00\x00\x00\x00\x00\x7F\x00\x00\x7F\x00\x00\x00\x00\x00\x00"//=
"\x00\x00\x00\x00\x06\x0C\x18\x30\x60\x30\x18\x0C\x06\x00\x00\x00"//>
"\x00\x00\x00\x3E\x63\x63\x63\x30\x18\x18\x00\x18\x18\x00\x00\x00"//?
"\x00\x00\x00\x3E\x63\x73\x6B\x6B\x6B\x6B\x73\x03\x7E\x00\x00\x00"//@
"\x00\x00\x00\x3E\x63\x63\x63\x63\x7F\x63\x63\x63\x63\x00\x00\x00"//A
"\x00\x00\x00\x3F\x63\x63\x63\x3F\x63\x63\x63\x63\x3F\x00\x00\x00"//B
"\x00\x00\x00\x3E\x63\x63\x03\x03\x03\x03\x63\x63\x3E\x00\x00\x00"//C
"\x00\x00\x00\x1F\x33\x63\x63\x63\x63\x63\x63\x33\x1F\x00\x00\x00"//D
"\x00\x00\x00\x7F\x03\x03\x03\x1F\x03\x03\x03\x03\x7F\x00\x00\x00"//E
"\x00\x00\x00\x7F\x03\x03\x03\x1F\x03\x03\x03\x03\x03\x00\x00\x00"//F
"\x00\x00\x00\x3E\x63\x63\x03\x03\x7B\x63\x63\x63\x3E\x00\x00\x00"//G
"\x00\x00\x00\x63\x63\x63\x63\x7F\x63\x63\x63\x63\x63\x00\x00\x00"//H
"\x00\x00\x00\x3C\x18\x18\x18\x18\x18\x18\x18\x18\x3C\x00\x00\x00"//I
"\x00\x00\x00\x78\x30\x30\x30\x30\x30\x30\x33\x33\x1E\x00\x00\x00"//J
"\x00\x00\x00\x63\x63\x33\x1B\x0F\x0F\x1B\x33\x63\x63\x00\x00\x00"//K
"\x00\x00\x00\x03\x03\x03\x03\x03\x03\x03\x03\x03\x7F\x00\x00\x00"//L
"\x00\x00\x00\x41\x63\x77\x7F\x6B\x63\x63\x63\x63\x63\x00\x00\x00"//M
"\x00\x00\x00\x63\x63\x63\x67\x6F\x7B\x73\x63\x63\x63\x00\x00\x00"//N
"\x00\x00\x00\x3E\x63\x63\x63\x63\x63\x63\x63\x63\x3E\x00\x00\x00"//O
"\x00\x00\x00\x3F\x63\x63\x63\x63\x3F\x03\x03\x03\x03\x00\x00\x00"//P
"\x00\x00\x00\x3E\x63\x63\x63\x63\x63\x63\x63\x7B\x3E\x60\x00\x00"//Q
"\x00\x00\x00\x3F\x63\x63\x63\x63\x3F\x0F\x1B\x33\x63\x00\x00\x00"//R
"\x00\x00\x00\x3E\x63\x03\x03\x3E\x60\x60\x63\x63\x3E\x00\x00\x00"//S
"\x00\x00\x00\xFF\x18\x18\x18\x18\x18\x18\x18\x18\x18\x00\x00\x00"//T
"\x00\x00\x00\x63\x63\x63\x63\x63\x63\x63\x63\x63\x3E\x00\x00\x00"//U
"\x00\x00\x00\x63\x63\x63\x63\x63\x36\x36\x36\x1C\x1C\x00\x00\x00"//V
"\x00\x00\x00\x63\x63\x63\x63\x63\x6B\x7F\x77\x63\x41\x00\x00\x00"//W
"\x00\x00\x00\x63\x63\x36\x36\x1C\x1C\x36\x36\x63\x63\x00\x00\x00"//X
"\x00\x00\x00\xC3\xC3\x66\x66\x3C\x18\x18\x18\x18\x18\x00\x00\x00"//Y
"\x00\x00\x00\x7F\x60\x60\x30\x18\x0C\x06\x03\x03\x7F\x00\x00\x00"//Z
;

void lcd_clear(void)
{
	lcd.clear();
}

void lcd_update(void)
{
	lcd.update();
}

void lcd_puts(int x,int y,const char *str)
{
	int i=0;
	while(str[i])
	{
		char *ptrR=(char*)&font_16x8[(str[i]-' ')*16];
		char *ptrW=(char*)&lcd.DataBuffer[x+y*lcd.LineByteCount];
		for(int j=0;j<16;j++)
		{
			*ptrW=*ptrR;
			ptrR++;
			ptrW+=lcd.LineByteCount;
		}
		x++;
		i++;
	}
}

void lcd_put_int(int x,int y,uint32_t n)
{
	char buf[32];
	buf[0]=(n/10000000)%10+'0';
	buf[1]=(n/1000000)%10+'0';
	buf[2]=(n/100000)%10+'0';
	buf[3]=(n/10000)%10+'0';
	buf[4]=(n/1000)%10+'0';
	buf[5]=(n/100)%10+'0';
	buf[6]=(n/10)%10+'0';
	buf[7]=(n/1)%10+'0';
	buf[8]=0;
	int i;
	for(i=0;i<7;i++)
	{
		if(buf[i]!='0')break;
	}
	lcd_puts(x,y,&buf[i]);
}

void lcd_display_isp(void)
{
	lcd.clear();
	lcd_puts(0,0,"   FIRMWARE");
	lcd_puts(0,16,"  UPLOADING...");
    lcd.update();
}

void lcd_display_need_power_off(void)
{
	lcd.clear();
	lcd_puts(0,0,"       NEED");
	lcd_puts(0,16,"  POWER OFF!!!");
	lcd.update();
}

void lcd_display_updating(void)
{
	lcd.clear();
	lcd_puts(0,8,"  UPDATING...");
	lcd.update();
}

void lcd_display_updating_error(void)
{
	lcd.clear();
	lcd_puts(0,0,"     UPDATE");
	lcd_puts(0,16,"    ERROR!!!");
	lcd.update();
}

